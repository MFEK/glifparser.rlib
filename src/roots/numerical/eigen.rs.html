<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `/home/fred/.cargo/registry/src/github.com-1ecc6299db9ec823/roots-0.0.7/src/numerical/eigen.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>eigen.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../source-script.js"></script><script defer src="../../../source-files.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../roots/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../roots/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../roots/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
</pre><pre class="rust"><code><span class="comment">/*
eigen.rs 0.2

This piece of code is transpiled EigenvalueDecomposition.java from Jama framework.
I had to do this, because I haven&#39;t found any buildable rust opensource project
to calculate real eigen values in Rust. There are many packages which are usually bound to
openBLAS, but I can&#39;t build them with gnu toolchain, and that&#39;s the only toolchain, which
allows gdb (and thus IDE) debug nowadays.

Quality code is far from perfect, hopefully someone will appreciate my one day of
manual code conversion nightmare and mention me in the source code.

Stepan Yakovenko,
https://github.com/stiv-yakovenko
*/

/* Added to roots 0.0.5 by Mikhail Vorotilov on request of Stepan Yakovenko */

</span><span class="kw">use </span>std::cmp;
<span class="kw">use </span>std::collections::VecDeque;
<span class="kw">use </span>std::fmt;
<span class="kw">use </span>std::ops::Index;
<span class="kw">use </span>std::ops::IndexMut;

<span class="kw">use </span><span class="kw">super</span>::FloatType;

<span class="kw">pub struct </span>Matrix {
    data: VecDeque&lt;f64&gt;,
    n: usize,
}
<span class="kw">impl </span>Matrix {
    <span class="kw">pub fn </span>new(n: usize) -&gt; Matrix {
        <span class="kw">let </span><span class="kw-2">mut </span>data = VecDeque::new();
        data.resize(n * n, <span class="number">0.</span>);
        Matrix { data: data, n: n }
    }
}
<span class="kw">impl </span>fmt::Debug <span class="kw">for </span>Matrix {
    <span class="kw">fn </span>fmt(<span class="kw-2">&amp;</span><span class="self">self</span>, f: <span class="kw-2">&amp;mut </span>fmt::Formatter) -&gt; fmt::Result {
        <span class="macro">write!</span>(f, <span class="string">&quot;{{&quot;</span>).ok();
        <span class="kw">for </span>r <span class="kw">in </span><span class="number">0</span>..<span class="self">self</span>.n {
            <span class="kw">for </span>c <span class="kw">in </span><span class="number">0</span>..<span class="self">self</span>.n {
                <span class="macro">write!</span>(f, <span class="string">&quot;{:.3?} &quot;</span>, <span class="self">self</span>[[c, r]]).ok();
            }
            <span class="macro">writeln!</span>(f, <span class="string">&quot;&quot;</span>).ok();
        }
        <span class="macro">write!</span>(f, <span class="string">&quot;}}&quot;</span>)
    }
}
<span class="kw">impl </span>Index&lt;[usize; <span class="number">2</span>]&gt; <span class="kw">for </span>Matrix {
    <span class="kw">type </span>Output = f64;
    <span class="kw">fn </span>index(<span class="kw-2">&amp;</span><span class="self">self</span>, idx: [usize; <span class="number">2</span>]) -&gt; <span class="kw-2">&amp;</span>f64 {
        <span class="kw-2">&amp;</span><span class="self">self</span>.data[idx[<span class="number">0</span>] + <span class="self">self</span>.n * idx[<span class="number">1</span>]]
    }
}
<span class="kw">impl </span>IndexMut&lt;[usize; <span class="number">2</span>]&gt; <span class="kw">for </span>Matrix {
    <span class="kw">fn </span>index_mut(<span class="kw-2">&amp;mut </span><span class="self">self</span>, idx: [usize; <span class="number">2</span>]) -&gt; <span class="kw-2">&amp;mut </span>f64 {
        <span class="self">self</span>.data.get_mut(idx[<span class="number">0</span>] + <span class="self">self</span>.n * idx[<span class="number">1</span>]).unwrap()
    }
}

<span class="kw">fn </span>cdiv(xr: f64, xi: f64, yr: f64, yi: f64) -&gt; (f64, f64) {
    <span class="kw">let </span>r: f64;
    <span class="kw">let </span>d: f64;
    <span class="kw">if </span>yr.abs() &gt; yi.abs() {
        r = yi / yr;
        d = yr + r * yi;
        ((xr + r * xi) / d, (xi - r * xr) / d)
    } <span class="kw">else </span>{
        r = yr / yi;
        d = yi + r * yr;
        ((r * xr + xi) / d, (r * xi - xr) / d)
    }
}

<span class="kw">pub fn </span>hqr2(n_in: usize, h: <span class="kw-2">&amp;mut </span>Matrix, v: <span class="kw-2">&amp;mut </span>Matrix, d: <span class="kw-2">&amp;mut </span>Vec&lt;f64&gt;, e: <span class="kw-2">&amp;mut </span>Vec&lt;f64&gt;) {
    <span class="comment">//  This is derived from the Algol procedure hqr2,
    //  by Martin and Wilkinson, Handbook for Auto. Comp.,
    //  Vol.ii-Linear Algebra, and the corresponding
    //  Fortran subroutine in EISPACK.
    // Initialize
    </span><span class="kw">let </span>nn = n_in;
    <span class="kw">let </span><span class="kw-2">mut </span>n = nn <span class="kw">as </span>i16 - <span class="number">1</span>;
    <span class="kw">let </span>low = <span class="number">0</span>;
    <span class="kw">let </span>high = nn - <span class="number">1</span>;
    <span class="kw">let </span>eps = (<span class="number">2.0</span>).powf(-<span class="number">52.0</span>);
    <span class="kw">let </span><span class="kw-2">mut </span>exshift = <span class="number">0.0</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>p = <span class="number">0.</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>q = <span class="number">0.</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>r = <span class="number">0.</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>s = <span class="number">0.</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>z = <span class="number">0.</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>t;
    <span class="kw">let </span><span class="kw-2">mut </span>w;
    <span class="kw">let </span><span class="kw-2">mut </span>x;
    <span class="kw">let </span><span class="kw-2">mut </span>y;
    <span class="comment">// Store roots isolated by balanc and compute matrix norm
    </span><span class="kw">let </span><span class="kw-2">mut </span>norm = <span class="number">0.0</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0 </span><span class="kw">as </span>usize;
    <span class="kw">while </span>i &lt; nn {
        <span class="kw">if </span>i &lt; low || i &gt; high {
            d[i] = h[[i, i]];
            e[i] = <span class="number">0.0</span>;
        }
        <span class="kw">let </span><span class="kw-2">mut </span>j = cmp::max(i <span class="kw">as </span>i16 - <span class="number">1</span>, <span class="number">0</span>) <span class="kw">as </span>usize;
        <span class="kw">while </span>j &lt; nn {
            norm = norm + (h[[i, j]]).abs();
            j = j + <span class="number">1</span>;
        }
        i = i + <span class="number">1</span>;
    }
    <span class="comment">// Outer loop over eigenvalue index
    </span><span class="kw">let </span><span class="kw-2">mut </span>iter = <span class="number">0</span>;
    <span class="kw">while </span>n &gt;= low <span class="kw">as </span>i16 {
        <span class="comment">// Look for single small sub-diagonal element
        </span><span class="kw">let </span><span class="kw-2">mut </span>l = n;
        <span class="kw">while </span>l &gt; low <span class="kw">as </span>i16 {
            s = (h[[l <span class="kw">as </span>usize - <span class="number">1</span>, l <span class="kw">as </span>usize - <span class="number">1</span>]]).abs() + (h[[l <span class="kw">as </span>usize, l <span class="kw">as </span>usize]]).abs();
            <span class="kw">if </span>s == <span class="number">0.0 </span>{
                s = norm;
            }
            <span class="kw">if </span>(h[[l <span class="kw">as </span>usize, l <span class="kw">as </span>usize - <span class="number">1</span>]]).abs() &lt; eps * s {
                <span class="kw">break</span>;
            }
            l = l - <span class="number">1</span>;
        }
        <span class="comment">// Check for convergence
        // One root found
        </span><span class="kw">if </span>l == n {
            h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] + exshift;
            d[n <span class="kw">as </span>usize] = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
            e[n <span class="kw">as </span>usize] = <span class="number">0.0</span>;
            n = n - <span class="number">1</span>;
            iter = <span class="number">0</span>;
        <span class="comment">// Two roots found
        </span>} <span class="kw">else if </span>l == n - <span class="number">1 </span>{
            w = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] * h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]];
            p = (h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] - h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]]) / <span class="number">2.0</span>;
            q = p * p + w;
            z = (q).abs().sqrt();
            h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] + exshift;
            h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] = h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] + exshift;
            x = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
            <span class="comment">// Real pair
            </span><span class="kw">if </span>q &gt;= <span class="number">0. </span>{
                <span class="kw">if </span>p &gt;= <span class="number">0. </span>{
                    z = p + z;
                } <span class="kw">else </span>{
                    z = p - z;
                }
                d[n <span class="kw">as </span>usize - <span class="number">1</span>] = x + z;
                d[n <span class="kw">as </span>usize] = d[n <span class="kw">as </span>usize - <span class="number">1</span>];
                <span class="kw">if </span>z != <span class="number">0.0 </span>{
                    d[n <span class="kw">as </span>usize] = x - w / z;
                }
                e[n <span class="kw">as </span>usize - <span class="number">1</span>] = <span class="number">0.0</span>;
                e[n <span class="kw">as </span>usize] = <span class="number">0.0</span>;
                x = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                s = (x).abs() + (z).abs();
                p = x / s;
                q = z / s;
                r = (p * p + q * q).sqrt();
                p = p / r;
                q = q / r;
                <span class="comment">// Row modification
                </span><span class="kw">let </span><span class="kw-2">mut </span>j = n - <span class="number">1</span>;
                <span class="kw">while </span>j &lt; nn <span class="kw">as </span>i16 {
                    z = h[[n <span class="kw">as </span>usize - <span class="number">1</span>, j <span class="kw">as </span>usize]];
                    h[[n <span class="kw">as </span>usize - <span class="number">1</span>, j <span class="kw">as </span>usize]] = q * z + p * h[[n <span class="kw">as </span>usize, j <span class="kw">as </span>usize]];
                    h[[n <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] = q * h[[n <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] - p * z;
                    j = j + <span class="number">1</span>;
                }
                <span class="comment">// Column modification
                </span><span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0</span>;
                <span class="kw">while </span>i &lt;= n {
                    z = h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                    h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = q * z + p * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
                    h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = q * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] - p * z;
                    i = i + <span class="number">1</span>;
                }
                <span class="comment">// Accumulate transformations
                </span><span class="kw">let </span><span class="kw-2">mut </span>i = low;
                <span class="kw">while </span>i &lt;= high {
                    z = v[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                    v[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = q * z + p * v[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
                    v[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = q * v[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] - p * z;
                    i = i + <span class="number">1</span>;
                }
            <span class="comment">// Complex pair
            </span>} <span class="kw">else </span>{
                d[n <span class="kw">as </span>usize - <span class="number">1</span>] = x + p;
                d[n <span class="kw">as </span>usize] = x + p;
                e[n <span class="kw">as </span>usize - <span class="number">1</span>] = z;
                e[n <span class="kw">as </span>usize] = -z;
            }
            n = n - <span class="number">2</span>;
            iter = <span class="number">0</span>;
        <span class="comment">// No convergence yet
        </span>} <span class="kw">else </span>{
            <span class="comment">// Form shift
            </span>x = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
            y = <span class="number">0.0</span>;
            w = <span class="number">0.0</span>;
            <span class="kw">if </span>l &lt; n {
                y = h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                w = h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] * h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]];
            }
            <span class="comment">// Wilkinson&#39;s original ad hoc shift
            </span><span class="kw">if </span>iter == <span class="number">10 </span>{
                exshift += x;
                <span class="kw">let </span><span class="kw-2">mut </span>i = low;
                <span class="kw">while </span>i &lt;= n <span class="kw">as </span>usize {
                    h[[i, i]] -= x;
                    i = i + <span class="number">1</span>;
                }
                s = (h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]]).abs() + (h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">2</span>]]).abs();
                y = <span class="number">0.75 </span>* s;
                x = y;
                w = -<span class="number">0.4375 </span>* s * s;
            }
            <span class="comment">// MATLAB&#39;s new ad hoc shift
            </span><span class="kw">if </span>iter == <span class="number">30 </span>{
                s = (y - x) / <span class="number">2.0</span>;
                s = s * s + w;
                <span class="kw">if </span>s &gt; <span class="number">0. </span>{
                    s = s.sqrt();
                    <span class="kw">if </span>y &lt; x {
                        s = -s;
                    }
                    s = x - w / ((y - x) / <span class="number">2.0 </span>+ s);
                    <span class="kw">let </span><span class="kw-2">mut </span>i = low;
                    <span class="kw">while </span>i &lt;= n <span class="kw">as </span>usize {
                        h[[i, i]] -= s;
                        i = i + <span class="number">1</span>;
                    }
                    exshift += s;
                    x = <span class="number">0.964</span>;
                    y = x;
                    w = y;
                }
            }
            iter = iter + <span class="number">1</span>; <span class="comment">// (Could check iteration count here.)
                             // Look for two consecutive small sub-diagonal elements
            </span><span class="kw">let </span><span class="kw-2">mut </span>m = n - <span class="number">2</span>;
            <span class="kw">while </span>m &gt;= l {
                z = h[[m <span class="kw">as </span>usize, m <span class="kw">as </span>usize]];
                r = x - z;
                s = y - z;
                p = (r * s - w) / h[[m <span class="kw">as </span>usize + <span class="number">1</span>, m <span class="kw">as </span>usize]] + h[[m <span class="kw">as </span>usize, m <span class="kw">as </span>usize + <span class="number">1</span>]];
                q = h[[m <span class="kw">as </span>usize + <span class="number">1</span>, m <span class="kw">as </span>usize + <span class="number">1</span>]] - z - r - s;
                r = h[[m <span class="kw">as </span>usize + <span class="number">2</span>, m <span class="kw">as </span>usize + <span class="number">1</span>]];
                s = (p).abs() + (q).abs() + (r).abs();
                p = p / s;
                q = q / s;
                r = r / s;
                <span class="kw">if </span>m == l {
                    <span class="kw">break</span>;
                }
                <span class="kw">if </span>h[[m <span class="kw">as </span>usize, m <span class="kw">as </span>usize - <span class="number">1</span>]].abs() * (q).abs() + (r).abs()
                    &lt; eps
                        * ((p).abs()
                            * ((h[[m <span class="kw">as </span>usize - <span class="number">1</span>, m <span class="kw">as </span>usize - <span class="number">1</span>]]).abs()
                                + (z).abs()
                                + (h[[m <span class="kw">as </span>usize + <span class="number">1</span>, m <span class="kw">as </span>usize + <span class="number">1</span>]]).abs()))
                {
                    <span class="kw">break</span>;
                }
                m = m - <span class="number">1</span>;
            }
            <span class="kw">let </span><span class="kw-2">mut </span>i = m + <span class="number">2</span>;
            <span class="kw">while </span>i &lt;= n {
                h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize - <span class="number">2</span>]] = <span class="number">0.0</span>;
                <span class="kw">if </span>i &gt; m + <span class="number">2 </span>{
                    h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize - <span class="number">3</span>]] = <span class="number">0.0</span>;
                }
                i = i + <span class="number">1</span>;
            }
            <span class="comment">// Double QR step involving rows l:n and columns m:n
            </span><span class="kw">let </span><span class="kw-2">mut </span>k = m;
            <span class="kw">while </span>k &lt;= n - <span class="number">1 </span>{
                <span class="kw">let </span>notlast = <span class="kw">if </span>k != n - <span class="number">1 </span>{ <span class="bool-val">true </span>} <span class="kw">else </span>{ <span class="bool-val">false </span>};
                <span class="kw">if </span>k != m {
                    p = h[[k <span class="kw">as </span>usize, k <span class="kw">as </span>usize - <span class="number">1</span>]];
                    q = h[[k <span class="kw">as </span>usize + <span class="number">1</span>, k <span class="kw">as </span>usize - <span class="number">1</span>]];
                    r = <span class="kw">if </span>notlast { h[[k <span class="kw">as </span>usize + <span class="number">2</span>, k <span class="kw">as </span>usize - <span class="number">1</span>]] } <span class="kw">else </span>{ <span class="number">0.0 </span>};
                    x = (p).abs() + (q).abs() + (r).abs();
                    <span class="kw">if </span>x == <span class="number">0.0 </span>{
                        k = k + <span class="number">1</span>;
                        <span class="kw">continue</span>;
                    }
                    p = p / x;
                    q = q / x;
                    r = r / x;
                }
                s = (p * p + q * q + r * r).sqrt();
                <span class="kw">if </span>p &lt; <span class="number">0. </span>{
                    s = -s;
                }
                <span class="kw">if </span>s != <span class="number">0. </span>{
                    <span class="kw">if </span>k != m {
                        h[[k <span class="kw">as </span>usize, k <span class="kw">as </span>usize - <span class="number">1</span>]] = -s * x;
                    } <span class="kw">else if </span>l != m {
                        h[[k <span class="kw">as </span>usize, k <span class="kw">as </span>usize - <span class="number">1</span>]] = -h[[k <span class="kw">as </span>usize, k <span class="kw">as </span>usize - <span class="number">1</span>]];
                    }
                    p = p + s;
                    x = p / s;
                    y = q / s;
                    z = r / s;
                    q = q / p;
                    r = r / p;
                    <span class="comment">// Row modification
                    </span><span class="kw">let </span><span class="kw-2">mut </span>j = k;
                    <span class="kw">while </span>j &lt; nn <span class="kw">as </span>i16 {
                        p = h[[k <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] + q * h[[k <span class="kw">as </span>usize + <span class="number">1</span>, j <span class="kw">as </span>usize]];
                        <span class="kw">if </span>notlast {
                            p = p + r * h[[k <span class="kw">as </span>usize + <span class="number">2</span>, j <span class="kw">as </span>usize]];
                            h[[k <span class="kw">as </span>usize + <span class="number">2</span>, j <span class="kw">as </span>usize]] = h[[k <span class="kw">as </span>usize + <span class="number">2</span>, j <span class="kw">as </span>usize]] - p * z;
                        }
                        h[[k <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] = h[[k <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] - p * x;
                        h[[k <span class="kw">as </span>usize + <span class="number">1</span>, j <span class="kw">as </span>usize]] = h[[k <span class="kw">as </span>usize + <span class="number">1</span>, j <span class="kw">as </span>usize]] - p * y;
                        j = j + <span class="number">1</span>;
                    }
                    <span class="comment">// Column modification
                    </span><span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0</span>;
                    <span class="kw">while </span>i &lt;= cmp::min(n <span class="kw">as </span>usize, k <span class="kw">as </span>usize + <span class="number">3</span>) {
                        p = x * h[[i, k <span class="kw">as </span>usize]] + y * h[[i <span class="kw">as </span>usize, k <span class="kw">as </span>usize + <span class="number">1</span>]];
                        <span class="kw">if </span>notlast {
                            p = p + z * h[[i, k <span class="kw">as </span>usize + <span class="number">2</span>]];
                            h[[i, k <span class="kw">as </span>usize + <span class="number">2</span>]] = h[[i, k <span class="kw">as </span>usize + <span class="number">2</span>]] - p * r;
                        }
                        h[[i, k <span class="kw">as </span>usize]] = h[[i, k <span class="kw">as </span>usize]] - p;
                        h[[i, k <span class="kw">as </span>usize + <span class="number">1</span>]] = h[[i, k <span class="kw">as </span>usize + <span class="number">1</span>]] - p * q;
                        i = i + <span class="number">1</span>;
                    }
                    <span class="comment">// Accumulate transformations
                    </span><span class="kw">let </span><span class="kw-2">mut </span>i = low;
                    <span class="kw">while </span>i &lt;= high {
                        p = x * v[[i, k <span class="kw">as </span>usize]] + y * v[[i, k <span class="kw">as </span>usize + <span class="number">1</span>]];
                        <span class="kw">if </span>notlast {
                            p = p + z * v[[i <span class="kw">as </span>usize, k <span class="kw">as </span>usize + <span class="number">2</span>]];
                            v[[i <span class="kw">as </span>usize, k <span class="kw">as </span>usize + <span class="number">2</span>]] = v[[i <span class="kw">as </span>usize, k <span class="kw">as </span>usize + <span class="number">2</span>]] - p * r;
                        }
                        v[[i, k <span class="kw">as </span>usize]] = v[[i, k <span class="kw">as </span>usize]] - p;
                        v[[i, k <span class="kw">as </span>usize + <span class="number">1</span>]] = v[[i, k <span class="kw">as </span>usize + <span class="number">1</span>]] - p * q;
                        i = i + <span class="number">1</span>;
                    }
                } <span class="comment">// (s != 0)
                </span>k = k + <span class="number">1</span>;
            } <span class="comment">// k loop
        </span>} <span class="comment">// check convergence
    </span>} <span class="comment">// while n &gt;= low
      // Backsubstitute to find vectors of upper triangular form
    </span><span class="kw">if </span>norm == <span class="number">0.0 </span>{
        <span class="kw">return</span>;
    }
    n = nn <span class="kw">as </span>i16 - <span class="number">1</span>;
    <span class="kw">while </span>n &gt;= <span class="number">0 </span>{
        p = d[n <span class="kw">as </span>usize];
        q = e[n <span class="kw">as </span>usize];
        <span class="comment">// Real vector
        </span><span class="kw">if </span>q == <span class="number">0. </span>{
            <span class="kw">let </span><span class="kw-2">mut </span>l = n;
            h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = <span class="number">1.0</span>;
            <span class="kw">let </span><span class="kw-2">mut </span>i = n <span class="kw">as </span>i16 - <span class="number">1</span>;
            <span class="kw">while </span>i &gt;= <span class="number">0 </span>{
                w = h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize]] - p;
                r = <span class="number">0.0</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>j = l;
                <span class="kw">while </span>j &lt;= n {
                    r = r + h[[i <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] * h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
                    j = j + <span class="number">1</span>;
                }
                <span class="kw">if </span>e[i <span class="kw">as </span>usize] &lt; <span class="number">0.0 </span>{
                    z = w;
                    s = r;
                } <span class="kw">else </span>{
                    l = i;
                    <span class="kw">if </span>e[i <span class="kw">as </span>usize] == <span class="number">0.0 </span>{
                        <span class="kw">if </span>w != <span class="number">0.0 </span>{
                            h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = -r / w;
                        } <span class="kw">else </span>{
                            h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = -r / (eps * norm);
                        }
                    <span class="comment">// Solve real equations
                    </span>} <span class="kw">else </span>{
                        x = h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize + <span class="number">1</span>]];
                        y = h[[i <span class="kw">as </span>usize + <span class="number">1</span>, i <span class="kw">as </span>usize]];
                        q = (d[i <span class="kw">as </span>usize] - p) * (d[i <span class="kw">as </span>usize] - p) + e[i <span class="kw">as </span>usize] * e[i <span class="kw">as </span>usize];
                        t = (x * s - z * r) / q;
                        h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = t;
                        <span class="kw">if </span>(x).abs() &gt; (z).abs() {
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize]] = (-r - w * t) / x;
                        } <span class="kw">else </span>{
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize]] = (-s - y * t) / z;
                        }
                    }
                    <span class="comment">// Overflow control
                    </span>t = h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
                    <span class="kw">if </span>(eps * t).abs() * t &gt; <span class="number">1. </span>{
                        <span class="kw">let </span><span class="kw-2">mut </span>j = i;
                        <span class="kw">while </span>j &lt;= n <span class="kw">as </span>i16 {
                            h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] / t;
                            j = j + <span class="number">1</span>;
                        }
                    }
                }
                i = i - <span class="number">1</span>;
            }
        <span class="comment">// Complex vector
        </span>} <span class="kw">else if </span>q &lt; <span class="number">0. </span>{
            <span class="kw">let </span><span class="kw-2">mut </span>l = n - <span class="number">1</span>;
            <span class="comment">// Last vector component imaginary so matrix is triangular
            </span><span class="kw">if </span>(h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]]).abs() &gt; (h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]]).abs() {
                h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] = q / h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]] = -(h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] - p) / h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
            } <span class="kw">else </span>{
                <span class="kw">let </span>(cdivr, cdivi) = cdiv(
                    <span class="number">0.0</span>,
                    -h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]],
                    h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] - p,
                    q,
                );
                h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] = cdivr;
                h[[n <span class="kw">as </span>usize - <span class="number">1</span>, n <span class="kw">as </span>usize]] = cdivi;
            }
            h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = <span class="number">0.0</span>;
            h[[n <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = <span class="number">1.0</span>;
            <span class="kw">let </span><span class="kw-2">mut </span>i = n - <span class="number">2</span>;
            <span class="kw">while </span>i &gt;= <span class="number">0 </span>{
                <span class="kw">let </span><span class="kw-2">mut </span>ra = <span class="number">0.</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>sa = <span class="number">0.</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>vr;
                <span class="kw">let </span>vi;
                <span class="kw">let </span><span class="kw-2">mut </span>j = l;
                <span class="kw">while </span>j &lt;= n {
                    ra = ra + h[[i <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] * h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]];
                    sa = sa + h[[i <span class="kw">as </span>usize, j <span class="kw">as </span>usize]] * h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]];
                    j = j + <span class="number">1</span>;
                }
                w = h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize]] - p;
                <span class="kw">if </span>e[i <span class="kw">as </span>usize] &lt; <span class="number">0.0 </span>{
                    z = w;
                    r = ra;
                    s = sa;
                } <span class="kw">else </span>{
                    l = i;
                    <span class="kw">if </span>e[i <span class="kw">as </span>usize] == <span class="number">0. </span>{
                        <span class="kw">let </span>(cdivr, cdivi) = cdiv(-ra, -sa, w, q);
                        h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = cdivr;
                        h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = cdivi;
                    } <span class="kw">else </span>{
                        <span class="comment">// Solve complex equations
                        </span>x = h[[i <span class="kw">as </span>usize, i <span class="kw">as </span>usize + <span class="number">1</span>]];
                        y = h[[i <span class="kw">as </span>usize + <span class="number">1</span>, i <span class="kw">as </span>usize]];
                        vr = (d[i <span class="kw">as </span>usize] - p) * (d[i <span class="kw">as </span>usize] - p) + e[i <span class="kw">as </span>usize] * e[i <span class="kw">as </span>usize] - q * q;
                        vi = (d[i <span class="kw">as </span>usize] - p) * <span class="number">2.0 </span>* q;
                        <span class="kw">if </span>vr == <span class="number">0.0 </span>&amp;&amp; vi == <span class="number">0.0 </span>{
                            vr = eps * norm * ((w).abs() + (q).abs() + (x).abs() + (y).abs() + (z)).abs();
                        }
                        <span class="kw">let </span>(cdivr, cdivi) = cdiv(x * r - z * ra + q * sa, x * s - z * sa - q * ra, vr, vi);
                        h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = cdivr;
                        h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = cdivi;
                        <span class="kw">if </span>(x).abs() &gt; ((z).abs() + (q).abs()) {
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] =
                                (-ra - w * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] + q * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]]) / x;
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize]] =
                                (-sa - w * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] - q * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]]) / x;
                        } <span class="kw">else </span>{
                            <span class="kw">let </span>(cdivr, cdivi) = cdiv(
                                -r - y * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]],
                                -s - y * h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]],
                                z,
                                q,
                            );
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize - <span class="number">1</span>]] = cdivr;
                            h[[i <span class="kw">as </span>usize + <span class="number">1</span>, n <span class="kw">as </span>usize]] = cdivi;
                        }
                    }
                    <span class="comment">// Overflow control
                    </span>t = (h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]]).abs().max(h[[i <span class="kw">as </span>usize, n <span class="kw">as </span>usize]].abs());
                    <span class="kw">if </span>(eps * t) * t &gt; <span class="number">1. </span>{
                        <span class="kw">let </span><span class="kw-2">mut </span>j = i;
                        <span class="kw">while </span>j &lt;= n {
                            j = j + <span class="number">1</span>;
                            h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] = h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize - <span class="number">1</span>]] / t;
                            h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] = h[[j <span class="kw">as </span>usize, n <span class="kw">as </span>usize]] / t;
                        }
                    }
                }
                i = i - <span class="number">1</span>;
            }
        }
        n = n - <span class="number">1</span>;
    }
    <span class="comment">// Vectors of isolated roots
    </span><span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0</span>;
    <span class="kw">while </span>i &lt; nn {
        <span class="kw">if </span>i &lt; low || i &gt; high {
            <span class="kw">let </span><span class="kw-2">mut </span>j = i;
            <span class="kw">while </span>j &lt; nn {
                v[[i, j]] = h[[i, j]];
                j = j + <span class="number">1</span>;
            }
        }
        i = i + <span class="number">1</span>;
    }
    <span class="comment">// Back transformation to get eigenvectors of original matrix
    </span><span class="kw">let </span><span class="kw-2">mut </span>j = nn <span class="kw">as </span>i16 - <span class="number">1</span>;
    <span class="kw">while </span>j &gt;= low <span class="kw">as </span>i16 {
        <span class="kw">let </span><span class="kw-2">mut </span>i = low;
        <span class="kw">while </span>i &lt;= high {
            z = <span class="number">0.0</span>;
            <span class="kw">let </span><span class="kw-2">mut </span>k = low;
            <span class="kw">while </span>k &lt;= cmp::min(j <span class="kw">as </span>usize, high) {
                z = z + v[[i, k]] * h[[k, j <span class="kw">as </span>usize]];
                k = k + <span class="number">1</span>;
            }
            v[[i, j <span class="kw">as </span>usize]] = z;
            i = i + <span class="number">1</span>;
        }
        j = j - <span class="number">1</span>;
    }
}

<span class="comment">//  This is derived from the Algol procedures orthes and ortran,
//  by Martin and Wilkinson, Handbook for Auto. Comp.,
//  Vol.ii-Linear Algebra, and the corresponding
//  Fortran subroutines in EISPACK.
</span><span class="attribute">#[allow(dead_code)]
</span><span class="kw">pub fn </span>orthes(m: <span class="kw-2">&amp;mut </span>Matrix, h_mat: <span class="kw-2">&amp;mut </span>Matrix, v_mat: <span class="kw-2">&amp;mut </span>Matrix) {
    <span class="kw">let </span>low = <span class="number">0</span>;
    <span class="kw">let </span>n = m.n;
    <span class="kw">let </span>high = n - <span class="number">1</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>m = low + <span class="number">1</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>ort = <span class="macro">vec!</span>[<span class="number">0.</span>; n];
    <span class="kw">while </span>m &lt; high - <span class="number">1 </span>{
        <span class="comment">// Scale column.
        </span><span class="kw">let </span><span class="kw-2">mut </span>scale = <span class="number">0.0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>i = m;
        <span class="comment">//for (int        i = m;        i &lt; = high;        i + +)
        </span><span class="kw">while </span>i &lt;= high {
            scale = scale + (h_mat[[i, m - <span class="number">1</span>]]).abs();
            i = i + <span class="number">1</span>;
        }
        <span class="kw">if </span>scale != <span class="number">0.0 </span>{
            <span class="comment">// Compute Householder transformation.
            </span><span class="kw">let </span><span class="kw-2">mut </span>h = <span class="number">0.0</span>;
            <span class="kw">let </span><span class="kw-2">mut </span>i = high;
            <span class="kw">while </span>i &gt;= m {
                ort[i] = h_mat[[i, m - <span class="number">1</span>]] / scale;
                h += ort[i] * ort[i];
                i = i - <span class="number">1</span>;
            }
            <span class="kw">let </span><span class="kw-2">mut </span>g = h.sqrt();
            <span class="kw">if </span>ort[m] &gt; <span class="number">0. </span>{
                g = -g;
            }
            h = h - ort[m] * g;
            ort[m] = ort[m] - g;
            <span class="comment">// Apply Householder similarity transformation
            // H = (I-u*u&#39;/h)*H*(I-u*u&#39;)/h)
            </span><span class="kw">let </span><span class="kw-2">mut </span>j = m;
            <span class="kw">while </span>j &lt; n {
                <span class="kw">let </span><span class="kw-2">mut </span>f = <span class="number">0.0</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>i = high;
                <span class="kw">while </span>i &gt;= m {
                    f += ort[i] * h_mat[[i, j]];
                    i = i - <span class="number">1</span>;
                }
                f = f / h;
                <span class="kw">let </span><span class="kw-2">mut </span>i = m;
                <span class="kw">while </span>i &lt;= high {
                    h_mat[[i, j]] -= f * ort[i];
                    i = i + <span class="number">1</span>;
                }
                j = j + <span class="number">1</span>;
            }
            <span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0</span>;
            <span class="kw">while </span>i &lt;= high {
                <span class="kw">let </span><span class="kw-2">mut </span>f = <span class="number">0.0</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>j = high;
                <span class="kw">while </span>j &gt;= m {
                    f += ort[j] * h_mat[[i, j]];
                    j = j - <span class="number">1</span>;
                }
                f = f / h;
                <span class="kw">let </span><span class="kw-2">mut </span>j = m;
                <span class="kw">while </span>j &lt;= high {
                    h_mat[[i, j]] -= f * ort[j];
                    j = j + <span class="number">1</span>;
                }
                i = i + <span class="number">1</span>;
            }
            ort[m] = scale * ort[m];
            h_mat[[m, m - <span class="number">1</span>]] = scale * g;
        }
        m = m + <span class="number">1</span>;
    }
    <span class="comment">// Accumulate transformations (Algol&#39;s ortran).
    </span><span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n {
        <span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..n {
            v_mat[[i, j]] = <span class="kw">if </span>i == j { <span class="number">1.0 </span>} <span class="kw">else </span>{ <span class="number">0.0 </span>};
        }
    }
    <span class="kw">let </span><span class="kw-2">mut </span>m = high - <span class="number">1</span>;
    <span class="kw">while </span>m &gt;= low + <span class="number">1 </span>{
        <span class="kw">if </span>h_mat[[m, m - <span class="number">1</span>]] != <span class="number">0.0 </span>{
            <span class="kw">let </span><span class="kw-2">mut </span>i = m + <span class="number">1</span>;
            <span class="kw">while </span>i &lt;= high {
                ort[i] = h_mat[[i, m - <span class="number">1</span>]];
                i = i + <span class="number">1</span>;
            }
            <span class="kw">let </span><span class="kw-2">mut </span>j = m;
            <span class="kw">while </span>j &lt;= high {
                <span class="kw">let </span><span class="kw-2">mut </span>g = <span class="number">0.0</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>i = m;
                <span class="kw">while </span>i &lt;= high {
                    g += ort[i] * v_mat[[i, j]];
                    i = i + <span class="number">1</span>;
                }
                <span class="comment">// Double division avoids possible underflow
                </span>g = (g / ort[m]) / h_mat[[m, m - <span class="number">1</span>]];
                <span class="kw">let </span><span class="kw-2">mut </span>i = m;
                <span class="kw">while </span>i &lt;= high {
                    v_mat[[i, j]] += g * ort[i];
                    i = i + <span class="number">1</span>;
                }
                j = j + <span class="number">1</span>;
            }
        }
        m = m - <span class="number">1</span>;
    }
}

<span class="kw">fn </span>calc_eigen(m: <span class="kw-2">&amp;mut </span>Matrix) -&gt; Vec&lt;(f64, f64)&gt; {
    <span class="kw">let </span>n = m.n;
    <span class="kw">let </span><span class="kw-2">mut </span>h_mat = Matrix::new(n);
    <span class="kw">let </span><span class="kw-2">mut </span>v_mat = Matrix::new(n);
    <span class="kw">let </span><span class="kw-2">mut </span>d = <span class="macro">vec!</span>[<span class="number">0.</span>; n];
    <span class="kw">let </span><span class="kw-2">mut </span>e = <span class="macro">vec!</span>[<span class="number">0.</span>; n];
    <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n {
        <span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..n {
            h_mat[[i, j]] = m[[i, j]];
        }
    }
    orthes(m, <span class="kw-2">&amp;mut </span>h_mat, <span class="kw-2">&amp;mut </span>v_mat);
    hqr2(n, <span class="kw-2">&amp;mut </span>h_mat, <span class="kw-2">&amp;mut </span>v_mat, <span class="kw-2">&amp;mut </span>d, <span class="kw-2">&amp;mut </span>e);
    <span class="kw">let </span><span class="kw-2">mut </span>r = <span class="macro">vec!</span>[(<span class="number">0.</span>, <span class="number">0.</span>); n];
    <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n {
        r[i] = (d[i], e[i])
    }
    r
}

<span class="doccomment">/// Find all roots of the normalized polynomial by finding eigen numbers of the corresponding matrix.
/// (Converted from Java by stiv-yakovenko)
///
/// Note that found roots are approximate and not sorted.
///
/// # Examples
///
/// ```
/// use roots::find_roots_eigen;
///
/// let roots = find_roots_eigen(vec!(0f64, -1f64, 0f64));
/// // Returns [0f64, 0.9999999999999999f64, -0.9999999999999999f64] while &#39;x^3 - x = 0&#39; has roots -1, 0, and 1
/// ```
</span><span class="kw">pub fn </span>find_roots_eigen(c: Vec&lt;f64&gt;) -&gt; VecDeque&lt;f64&gt; {
    <span class="kw">let </span>n = c.len();
    <span class="kw">let </span><span class="kw-2">mut </span>m = Matrix::new(n);
    <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..(n - <span class="number">1</span>) {
        m[[i + <span class="number">1</span>, i]] = <span class="number">1.</span>;
    }
    <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..(n) {
        m[[i, n - <span class="number">1</span>]] = -c[i];
    }
    <span class="kw">let </span>ei = calc_eigen(<span class="kw-2">&amp;mut </span>m);
    <span class="kw">let </span><span class="kw-2">mut </span>r = VecDeque::new();
    <span class="kw">for </span>c <span class="kw">in </span>ei {
        <span class="kw">if </span>c.<span class="number">1 </span>* c.<span class="number">1 </span>== <span class="number">0. </span>{
            r.push_back(c.<span class="number">0</span>);
        }
    }
    r
}

<span class="attribute">#[cfg(test)]
</span><span class="kw">mod </span>test {
    <span class="kw">use </span><span class="kw">super</span>::<span class="kw">super</span>::<span class="kw">super</span>::<span class="kw-2">*</span>;

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_find_roots_eigen() {
        <span class="kw">let </span>roots = find_roots_eigen(<span class="macro">vec!</span>[<span class="number">0f64</span>, -<span class="number">1f64</span>, <span class="number">0f64</span>]);
        <span class="macro">assert_eq!</span>(roots[<span class="number">0</span>], <span class="number">0f64</span>);
        <span class="macro">assert_eq!</span>(roots[<span class="number">1</span>], <span class="number">0.9999999999999999f64</span>);
        <span class="macro">assert_eq!</span>(roots[<span class="number">2</span>], -<span class="number">0.9999999999999999f64</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_find_roots_eigen_huge_discriminant() {
        <span class="comment">// Try to find roots of the normalized cubic polynomial where the highest coefficient was very small
        // (as reported by Andrew Hunter in July 2019)
        </span><span class="kw">let </span>roots = find_roots_eigen(<span class="macro">vec!</span>[
            <span class="number">0.0126298310280606f64 </span>/ -<span class="number">0.000000000000000040410628481035f64</span>,
            -<span class="number">0.100896606408756f64 </span>/ -<span class="number">0.000000000000000040410628481035f64</span>,
            <span class="number">0.0689539597036461f64 </span>/ -<span class="number">0.000000000000000040410628481035f64</span>,
        ]);
        <span class="comment">// (According to Wolfram Alpha, roots must be 0.7547108770537f64, 7.23404258961f64, 312537357195213f64)
        // This means that this function cannot handle such huge numbers.
        </span><span class="macro">assert_eq!</span>(roots[<span class="number">0</span>], <span class="number">0f64</span>);
        <span class="macro">assert_eq!</span>(roots[<span class="number">1</span>], <span class="number">1.5f64</span>);
        <span class="macro">assert_eq!</span>(roots[<span class="number">2</span>], <span class="number">1706332276816893f64</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_find_roots_eigen_tim_lueke() {
        <span class="comment">// Try to find roots of the normalized quartic polynomial where the discriminant must be 0
        // (as reported by Tim Lueke in December 2019)
        </span><span class="kw">let </span>roots = <span class="macro">dbg!</span>(find_roots_eigen(<span class="macro">vec!</span>[
            -<span class="number">3.75f64 </span>/ -<span class="number">14.0625f64</span>,
            <span class="number">29.75f64 </span>/ -<span class="number">14.0625f64</span>,
            <span class="number">4.0f64 </span>/ -<span class="number">14.0625f64</span>,
            -<span class="number">16.0f64 </span>/ -<span class="number">14.0625f64</span>,
        ]));
        <span class="comment">// (According to Wolfram Alpha, roots must be -1.1016116464173349f64, 0.9682783130840016f64)
        // This means that this function cannot handle such small discriminant.
        // But at least it finds the right number of them.
        </span><span class="macro">assert_eq!</span>(roots[<span class="number">0</span>], <span class="number">0.9990584398692597f64</span>);
        <span class="macro">assert_eq!</span>(roots[<span class="number">1</span>], <span class="number">0.12511486301943303f64</span>);
    }
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="roots" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>